@if (User.Identity.IsAuthenticated && (User.IsInRole("Admin") || User.IsInRole("Owner") || User.IsInRole("Editor") ))
{
	<li class="nav-item">
		<a class="nav-link" asp-area="Admin" asp-controller="Dashboard" asp-action="Index">
			<i class="fa-solid fa-gear"></i>
			@Localizer["ControlPanel"]
		</a>
	</li>
}

@if (User.Identity.IsAuthenticated)
{
	<li class="nav-item">
		<a class="nav-link" aria-current="page"
		   asp-area=""
		   asp-controller="Account"
		   asp-route-returnUrl="@(Context.Request.QueryString.HasValue ? $"{Context.Request.Path}{Context.Request.QueryString}" : Context.Request.Path)"
		   asp-action="Logout">
			<i class="fa-solid fa-right-from-bracket"></i>
			@Localizer["Logout"]
		</a>
	</li>
}
else
{
	/*
	<li class="nav-item">
		<a class="nav-link" aria-current="page"
		   asp-area=""
		   asp-controller="Account"
		   asp-route-returnUrl="@(Context.Request.QueryString.HasValue ? $"{Context.Request.Path}{Context.Request.QueryString}" : Context.Request.Path)"
		   asp-action="Login">
			<i class="bi bi-box-arrow-in-right"></i>
			@Localizer["Login"]
		</a>
	</li>
	*/
	<li class="nav-item">
		<button type="button" class="nav-link" data-bs-toggle="modal" data-bs-target="#loginModal">
			<i class="bi bi-box-arrow-in-right"></i>
			@Localizer["Login"]
		</button>
	</li>
	<li class="nav-item">
		<a class="nav-link" aria-current="page"
		   asp-area=""
		   asp-controller="Account"
		   asp-route-returnUrl="@(Context.Request.QueryString.HasValue ? $"{Context.Request.Path}{Context.Request.QueryString}" : Context.Request.Path)"
		   asp-action="Register">
			<i class="bi bi-person-add"></i>
			@Localizer["Register"]
		</a>
	</li>
}

<!-- Add this modal at the bottom of _Layout.cshtml (or shared layout) -->
<div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true" data-bs-backdrop="static">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="loginModalLabel">
                    <i class="bi bi-box-arrow-in-right"></i>
                    @Localizer["Login"]
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Step 1: Phone Number -->
                <div id="step1">
                    <div class="input-group mb-3">
                        <span class="input-group-text">+90</span>
                        <div class="form-floating">
                            <input type="tel"
                                   class="form-control"
                                   id="loginPhone"
                                   placeholder="@Localizer["PhoneNumber"]"
                                   data-mask="(999) 999 99 99">
                            <label for="loginPhone">@Localizer["PhoneNumber"]</label>
                        </div>
                    </div>
                    <button class="btn btn-primary w-100" onclick="sendOTP()">
                        @Localizer["SendOTP"]
                    </button>
                </div>

                <!-- Step 2: OTP -->
                <div id="step2" style="display: none;">
                    <form asp-action="Login" method="post" id="loginForm">
                        <input type="hidden" name="PhoneNumber" id="formPhoneNumber">
                        <input type="hidden" name="ReturnUrl" value="@Context.Request.QueryString">

                        <div class="form-floating mb-3">
                            <input type="text"
                                   class="form-control"
                                   id="loginOTP"
                                   name="OneTimePassword"
                                   placeholder="@Localizer["OneTimePassword"]">
                            <label for="loginOTP">@Localizer["OneTimePassword"]</label>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">
                            @Localizer["VerifyOTP"]
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .modal-backdrop.show {
        opacity: 0.85 !important;
    }
</style>

@section Scripts {
    <script>
        function sendOTP() {
            const phoneInput = document.getElementById('loginPhone');
            const formattedPhone = phoneInput.value.replace(/\D/g,'');

            if(formattedPhone.length !== 10) {
                alert('@Localizer["InvalidPhoneNumber"]');
                return;
            }

            // Show loading state
            document.getElementById('step1').style.opacity = '0.5';

            // Dummy OTP request
            fetch('/Account/GenerateDummyOTP?phoneNumber=' + formattedPhone)
                .then(response => response.text())
                .then(otp => {
                    document.getElementById('step1').style.display = 'none';
                    document.getElementById('step2').style.display = 'block';
                    document.getElementById('formPhoneNumber').value = formattedPhone;
                    console.log('Dummy OTP:', otp); // For testing
                });
        }
    </script>
}