@model IEnumerable<CustomerAppointmentDto>

<div class="card card-dark bg-dark border-black">
	<div class="card-header align-items-center">
		<h5 class="card-title mb-0 text-light">@Localizer["CustomerAppointments"]</h5>
		<div class="d-flex justify-content-end">
			<a asp-action="Create" class="btn btn-success btn-sm">
				<i class="bi bi-plus-lg"></i>
				@Localizer["Create"]
			</a>
		</div>
	</div>
	<p>Current Thread culture: @System.Threading.Thread.CurrentThread.CurrentCulture.Name</p>
	<div class="debug-info">
		Current Culture: @CultureInfo.CurrentCulture.Name<br>
		Decimal Separator: @CultureInfo.CurrentCulture.NumberFormat.CurrencyDecimalSeparator<br>
		Sample Format: @(1234.56m.ToString("C", CultureInfo.CurrentCulture))
	</div>
	<div class="card-body text-light">
		<div class="table-responsive">
			<table id="customerAppointmentsTable" class="table table-dark table-hover table-striped align-middle mb-0">
				<thead class="table-secondary">
					<tr>
						<th class="text-center">@Localizer["Id"]</th>
						<th>@Localizer["Customer"]</th>
						<th>@Localizer["OfferedServices"]</th>
						<th class="text-center">@Localizer["Gender"]</th>
						<th class="text-center">@Localizer["AgeGroup"]</th>
						<th>@Localizer["Employee"]</th>
						<th>@Localizer["ApproximateDuration"]</th>
						<th class="pe-5 text-end">@Localizer["Price"] @NumberFormatInfo.CurrentInfo.CurrencySymbol</th>
						<th>@Localizer["DateTime"]</th>
						<th>@Localizer["PhoneNumber"]</th>
						<th>@Localizer["EMail"]</th>
						<th>@Localizer["CreatedBy"]</th>
						<th class="text-center">@Localizer["Status"]</th>
						<th>@Localizer["Operations"]</th>
					</tr>
				</thead>
				<tbody>
					@foreach (var customerAppointment in Model)
					{
						<tr>
							<!-- Existing columns remain the same but add text-truncate where needed -->
							<td class="text-center">@customerAppointment.CustomerAppointmentId</td>
							<td class="text-truncate">@customerAppointment.Name @customerAppointment.Surname</td>
							<td>
								@foreach (var offeredService in customerAppointment.OfferedServices)
								{
									<div class="p-2 text-center rounded-4 border border-success border-opacity-25 col-form-label-sm mb-1">
										@offeredService.OfferedServiceName
									</div>
								}
							</td>
							<td class="text-center">
								@if (@customerAppointment.Gender == Entities.Models.Enums.Gender.Male)
								{
									<i class="bi bi-gender-male"></i>
									@Localizer["Male"]
								}
								else
								{
									<i class="bi bi-gender-female"></i>
									@Localizer["Female"]
								}
							</td>
							<td class="text-center">@customerAppointment.AgeGroup.Name</td>
							<td class="text-truncate">@customerAppointment.Employee.EmployeeName @customerAppointment.Employee.EmployeeSurname</td>
							<td>@customerAppointment.ApproximateDuration</td>
							<td class="pe-5 text-end" data-order="@customerAppointment.Price">@customerAppointment.Price.ToString("C", CultureInfo.CurrentCulture)</td>
							<td>@customerAppointment.StartDateTime.ToString("yyyy-MM-dd dddd HH:mm")</td>
							<td>@customerAppointment.PhoneNumber</td>
							<td class="text-truncate">@customerAppointment.EMail</td>
							<td class="text-truncate">@customerAppointment.CreatedBy</td>
							@if (@customerAppointment.Status == CustomerAppointmentStatus.AwaitingApproval)
							{
								<td class="text-center text-primary">
									@customerAppointment.Status
								</td>
							}
							else if (@customerAppointment.Status == CustomerAppointmentStatus.Completed)
							{
								<td class="text-center text-secondary">
									@customerAppointment.Status
								</td>
							}
							else if (@customerAppointment.Status == CustomerAppointmentStatus.Cancelled)
							{
								<td class="text-center text-danger">
									@customerAppointment.Status
								</td>
							}
							else if (@customerAppointment.Status == CustomerAppointmentStatus.Confirmed)
							{
								<td class="text-center text-success">
									@customerAppointment.Status
								</td>
							}
							else if (@customerAppointment.Status == CustomerAppointmentStatus.CustomerConfirmed)
							{
								<td class="text-center text-info-emphasis">
									@customerAppointment.Status
								</td>
							}
							<td>
								<div class="d-flex gap-1 justify-content-center">
									<!-- Operations buttons with responsive text -->
									@if (customerAppointment.Status == CustomerAppointmentStatus.AwaitingApproval)
									{
										<button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#fastApproveModal">
											<i class="bi bi-hand-thumbs-up"></i>
											<span class="d-md-inline">@Localizer["FastApprove"]</span>
										</button>
										<div class="modal fade" id="fastApproveModal" tabindex="-1" aria-hidden="true">
											<div class="modal-dialog modal-sm modal-dialog-centered">
												<div class="modal-content">
													<div class="modal-header">
														<h1 class="modal-title fs-5" id="exampleModalLabel">@Localizer["ApproveAppointment"]</h1>
														<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
													</div>
													<div class="modal-body">
														@Localizer["WouldYouLikeToApproveThisAppointment?"]
													</div>
													<div class="modal-footer">
														<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">@Localizer["Close"]</button>
														<form asp-action="ApproveAppointment" asp-route-id="@customerAppointment.CustomerAppointmentId" method="post" class="d-inline">
															<button type="submit" class="btn btn-success">
																<i class="bi bi-check2"></i>
																@Localizer["Approve"]
															</button>
														</form>
													</div>
												</div>
											</div>
										</div>
										<!-- Modal remains same -->
									}

									<a asp-action="Update" asp-route-id="@customerAppointment.CustomerAppointmentId"
									   class="btn btn-warning btn-sm">
										<i class="fa-solid fa-pen-to-square"></i>
										<span class="d-md-inline">@Localizer["Update"]</span>
									</a>
									@if (customerAppointment.Status != CustomerAppointmentStatus.Cancelled &&
																	customerAppointment.Status != CustomerAppointmentStatus.Completed)
									{
										<button type="button" class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#fastCancelModal">
											<i class="bi bi-x-octagon"></i>
											<span class="d-md-inline">@Localizer["FastCancel"]</span>
										</button>
										<div class="modal fade" id="fastCancelModal" tabindex="-1" aria-hidden="true">
											<div class="modal-dialog modal-sm modal-dialog-centered">
												<div class="modal-content">
													<div class="modal-header">
														<h1 class="modal-title fs-5" id="exampleModalLabel">@Localizer["CancelAppointment"]</h1>
														<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
													</div>
													<div class="modal-body">
														@Localizer["WouldYouLikeToCancelThisAppointment?"]
													</div>
													<div class="modal-footer">
														<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">@Localizer["Close"]</button>
														<form asp-action="CancelAppointment" asp-route-id="@customerAppointment.CustomerAppointmentId" method="post" class="d-inline">
															<button type="submit" class="btn btn-success">
																<i class="bi bi-trash3"></i>
																@Localizer["Cancel"]
															</button>
														</form>
													</div>
												</div>
											</div>
										</div>
									}
								</div>
							</td>
						</tr>
					}
				</tbody>
			</table>
		</div>
	</div>
</div>
<div class="toast-container position-fixed bottom-0 end-0 p-3">
	@await Html.PartialAsync("_Toasts")
</div>
@section Scripts {
	<script>
		$(document).ready(function () {
			$('#customerAppointmentsTable').DataTable({
				columnDefs: [ {
					"orderable": false,
					"targets": [ 13 ]
				} ],
				responsive: true,
				paging: true,
				searching: true,
				ordering: true,
				lengthChange: true,
				language: {
					search: "@Localizer["Search"] : ",
					lengthMenu: "@Localizer["Show _MENU_ entries"]",
					info: "@Localizer["Showing _START_ to _END_ of _TOTAL_ entries"]",
					paginate: {
						previous: "@Localizer["Previous"]",
						next: "@Localizer["Next"]"
					}
				}
			});
		});
	</script>
	<script>
		$(document).ready(function ()
		{
			const successfullToast = document.getElementById('successfullToast')
			const failureToast = document.getElementById('failureToast')
			if(@(@TempData["OperationSuccessfull"] != null ? "true" : "false"))
			{
				if (@(@TempData["OperationMessage"] != null ? "true" : "false") && @Html.Raw(Json.Serialize(@TempData["OperationMessage"])) != "")
				{
					if(@Html.Raw(Json.Serialize(@TempData["OperationSuccessfull"])) == true)
					{
						const toastBootstrap = bootstrap.Toast.getOrCreateInstance(successfullToast)
						toastBootstrap.show()
					}
					else
					{
						const toastBootstrap = bootstrap.Toast.getOrCreateInstance(failureToast)
						toastBootstrap.show()
					}
				}
			}

		})
	</script>
}
